
<div class="sub-comment-wrapper">

  <input type="text"
         required
         class="form-control"
         [formControl]="commentForm"
         placeholder="Enter comment">

  <div class="leave-comment-card-buttons">

    <button
      *ngIf="commentForm.value"
      style="margin-top: 5px; margin-right: 10px"
      type="button"
      class="btn btn-primary"
      [disabled]="this.commentForm.invalid"
      (click)="postComment()">Leave Comment!</button>

    @if (!comments) { 
      <a (click)="refreshComments()">{{ parentId? "Load subcomments..." : "Load more comments..." }} </a>
    }
  </div>

  @if (comments) {
    <div id="comment-card-wrapper">
      @for (comment of comments; track comment.commentId; let i = $index) {
        <div class="comment-card" >

          <div class="vote-card">

            @if (currentCommunity.isCommunityMember) {
              <app-voting
                [type]="'COMMENT'"
                [postId]="this.postId"
                [commentId]="comment.commentId"
                (voteUpdated)="commentVoteUpdated($event, i)"
                ></app-voting>
              <h1 class="vote-count">{{ comment.vote }}</h1>
            } @else {
              <div class="icon-tooltip-hover">
                <i class="bi bi-arrows-expand"></i>
              </div>
              <p class="icon-tooltip">Please join community to interact with posts and comments!</p>
              <h1 class="vote-count">{{ comment.vote }}</h1>
            }

            <button 
              class="btn btn-outline-primary"
              *ngIf="currentCommunity.isCommunityMember"
              (click)="reportComment(comment.commentId)">Report</button>
            <button 
              class="btn btn-primary" 
              *ngIf="currentCommunity.isCommentMod"
              (click)="removeComment(comment.commentId)">Remove</button>
          </div>
    

          <div class="comment-text">
            <h4>:{{comment.displayName}}</h4>

            <p>{{comment.body}}</p>
          </div>
        </div>

        <app-comments [postId]="postId" [parentId]="comment.commentId"></app-comments>
      } @empty {
        <p>No comments to display</p>
      }
    </div>
  }
</div>
